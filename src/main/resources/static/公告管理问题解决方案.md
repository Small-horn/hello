# 公告管理页面新建公告按钮问题解决方案

## 问题描述
公告管理页面的新建公告按钮打不开。

## 问题原因分析

### 1. 权限问题（最可能的原因）
- 只有管理员（ADMIN）和教师（TEACHER）角色才能创建公告
- 如果用户未登录或权限不足，新建公告按钮会被隐藏
- 学生（STUDENT）和访客（GUEST）用户无法看到新建按钮

### 2. 用户未登录
- 未登录用户无法访问公告管理功能
- 系统会自动隐藏编辑相关的按钮

### 3. JavaScript事件绑定问题
- 权限检查失败时，按钮事件不会被绑定
- 模态框可能因为权限检查而无法显示

## 解决步骤

### 步骤1：确保用户登录
1. 访问登录页面：`http://localhost:8080/index.html`
2. 使用以下测试账号登录：

**管理员账号：**
- 用户名：`admin`
- 密码：`123`
- 角色：系统管理员

**教师账号：**
- 用户名：`teacher1`
- 密码：`123`
- 角色：张教授（计算机学院）

**其他教师账号：**
- 用户名：`teacher2`
- 密码：`123`
- 角色：李老师（数学学院）

### 步骤2：访问公告管理页面
1. 登录成功后，访问：`http://localhost:8080/announcement-management.html`
2. 检查页面上是否显示以下按钮：
   - 新建公告（蓝色按钮）
   - 新建活动（绿色按钮）
   - 调试模态框（红色按钮，用于测试）

### 步骤3：测试功能
1. 点击"新建公告"按钮，应该弹出公告编辑模态框
2. 如果按钮不可见，说明权限不足
3. 如果按钮可见但点击无反应，使用"调试模态框"按钮测试

### 步骤4：检查浏览器控制台
1. 按F12打开浏览器开发者工具
2. 切换到Console标签页
3. 查看是否有JavaScript错误或权限相关的日志信息

## 权限说明

### 有权限的用户角色：
- **ADMIN（管理员）**：拥有所有权限，可以创建、编辑、删除公告
- **TEACHER（教师）**：可以创建、编辑公告，但权限可能受限

### 无权限的用户角色：
- **STUDENT（学生）**：只能查看公告，无法创建或编辑
- **GUEST（访客）**：只能查看公告，无法创建或编辑
- **未登录用户**：功能受限，无法访问管理功能

## 调试功能

我已经在页面上添加了一个红色的"调试模态框"按钮，该按钮可以：
1. 显示当前用户信息
2. 检查模态框元素是否存在
3. 强制显示模态框进行测试
4. 在浏览器控制台输出详细的调试信息

## 常见问题解决

### 问题1：登录后仍然看不到新建按钮
**解决方案：**
- 检查登录的用户角色是否为ADMIN或TEACHER
- 刷新页面重新加载权限信息
- 检查浏览器控制台是否有权限检查失败的错误

### 问题2：按钮可见但点击无反应
**解决方案：**
- 使用"调试模态框"按钮测试模态框功能
- 检查浏览器控制台的JavaScript错误
- 确认模态框HTML元素是否正确加载

### 问题3：模态框显示但内容异常
**解决方案：**
- 检查富文本编辑器是否正确加载
- 确认所有必要的JavaScript库都已加载
- 检查网络连接，确保CDN资源可以正常访问

## 技术细节

### 权限检查逻辑：
```javascript
// 只有管理员和教师可以使用编辑功能
if (user && (user.role === 'ADMIN' || user.role === 'TEACHER')) {
    // 绑定新建公告按钮事件
    $('#add-announcement-btn').click(() => showAnnouncementModal('ANNOUNCEMENT'));
} else {
    // 隐藏编辑按钮
    $('#add-announcement-btn, #add-activity-btn').hide();
}
```

### 模态框显示逻辑：
```javascript
function showAnnouncementModal(type) {
    // 权限检查
    if (!currentUser || (currentUser.role !== 'ADMIN' && currentUser.role !== 'TEACHER')) {
        showMessage('您没有权限创建公告', 'error');
        return;
    }
    
    // 显示模态框
    $('#announcement-modal').show();
}
```

## 联系支持

如果按照以上步骤仍然无法解决问题，请：
1. 提供浏览器控制台的错误信息
2. 说明使用的用户账号和角色
3. 描述具体的操作步骤和现象
