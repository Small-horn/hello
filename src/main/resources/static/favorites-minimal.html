<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的收藏 - 最小化测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>我的收藏 - 最小化测试</h1>
        <p>这是一个最小化的收藏页面，用于测试是否会发生自动跳转</p>
        
        <div id="status" class="log">页面加载中...</div>
        <div id="debug-log" class="log">调试日志...</div>
        
        <p>
            <a href="dashboard.html">返回首页</a> |
            <a href="test-auth.html">认证测试</a> |
            <a href="favorites.html">完整收藏页面</a>
        </p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = $('#debug-log');
            const colorClass = type;
            logElement.append(`<span class="${colorClass}">[${timestamp}] ${message}</span>\n`);
            logElement.scrollTop(logElement[0].scrollHeight);
            console.log(`[${timestamp}] ${message}`);
        }
        
        $(document).ready(function() {
            log('最小化收藏页面加载完成');
            $('#status').html('<span class="success">页面加载完成，没有发生跳转</span>');
            
            // 监听页面跳转
            let originalLocation = window.location.href;
            let checkCount = 0;
            const checkInterval = setInterval(function() {
                checkCount++;
                if (window.location.href !== originalLocation) {
                    log(`检测到页面跳转: ${originalLocation} -> ${window.location.href}`, 'error');
                    clearInterval(checkInterval);
                } else if (checkCount >= 50) { // 5秒后停止检查
                    log('5秒内没有检测到页面跳转，测试通过', 'success');
                    clearInterval(checkInterval);
                }
            }, 100);
            
            // 检查认证状态
            setTimeout(function() {
                log('检查认证状态...');
                $.ajax({
                    url: '/api/auth/current',
                    method: 'GET',
                    success: function(response) {
                        if (response.success && response.authenticated && response.user) {
                            log(`用户已登录: ${response.user.username} (${response.user.role})`, 'success');
                        } else {
                            log('用户未登录', 'warning');
                        }
                    },
                    error: function(xhr, status, error) {
                        log(`认证检查失败: ${error}`, 'error');
                    }
                });
            }, 1000);
        });
    </script>
</body>
</html>
