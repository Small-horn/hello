<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­›é€‰åŠŸèƒ½è°ƒè¯•é¡µé¢</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/management.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .debug-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .debug-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .debug-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #dee2e6;
            font-weight: 600;
        }
        
        .debug-content {
            padding: 1.5rem;
        }
        
        .test-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .debug-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
        
        .api-test-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        
        .error-result {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .success-result {
            border-left-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ ç­›é€‰åŠŸèƒ½è°ƒè¯•é¡µé¢</h1>
        <p>ç”¨äºè°ƒè¯•å’Œæµ‹è¯•å…¬å‘Šç®¡ç†é¡µé¢çš„ç­›é€‰åŠŸèƒ½é—®é¢˜</p>
        
        <!-- API è¿æ¥æµ‹è¯• -->
        <div class="debug-section">
            <div class="debug-header">
                <i class="fas fa-plug"></i> API è¿æ¥æµ‹è¯•
            </div>
            <div class="debug-content">
                <div class="test-controls">
                    <button onclick="testBasicAPI()" class="btn btn-primary">
                        <i class="fas fa-play"></i> æµ‹è¯•åŸºç¡€API
                    </button>
                    <button onclick="testFilterAPI()" class="btn btn-info">
                        <i class="fas fa-filter"></i> æµ‹è¯•ç­›é€‰API
                    </button>
                    <button onclick="testSearchAPI()" class="btn btn-success">
                        <i class="fas fa-search"></i> æµ‹è¯•æœç´¢API
                    </button>
                    <button onclick="clearDebugOutput()" class="btn btn-secondary">
                        <i class="fas fa-eraser"></i> æ¸…é™¤è¾“å‡º
                    </button>
                </div>
                
                <div id="api-test-output" class="debug-output">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>
        
        <!-- å‚æ•°éªŒè¯æµ‹è¯• -->
        <div class="debug-section">
            <div class="debug-header">
                <i class="fas fa-check-circle"></i> å‚æ•°éªŒè¯æµ‹è¯•
            </div>
            <div class="debug-content">
                <div class="test-controls">
                    <select id="test-status" class="form-control">
                        <option value="">é€‰æ‹©çŠ¶æ€</option>
                        <option value="DRAFT">DRAFT</option>
                        <option value="PUBLISHED">PUBLISHED</option>
                        <option value="CANCELLED">CANCELLED</option>
                        <option value="EXPIRED">EXPIRED</option>
                        <option value="INVALID">INVALID (æ— æ•ˆå€¼)</option>
                    </select>
                    
                    <select id="test-type" class="form-control">
                        <option value="">é€‰æ‹©ç±»å‹</option>
                        <option value="ANNOUNCEMENT">ANNOUNCEMENT</option>
                        <option value="ACTIVITY">ACTIVITY</option>
                        <option value="INVALID">INVALID (æ— æ•ˆå€¼)</option>
                    </select>
                    
                    <input type="text" id="test-keyword" placeholder="æœç´¢å…³é”®è¯" class="form-control">
                    
                    <button onclick="testParameters()" class="btn btn-warning">
                        <i class="fas fa-vial"></i> æµ‹è¯•å‚æ•°
                    </button>
                </div>
                
                <div id="param-test-output" class="debug-output">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>
        
        <!-- é”™è¯¯æ¨¡æ‹Ÿ -->
        <div class="debug-section">
            <div class="debug-header">
                <i class="fas fa-bug"></i> é”™è¯¯æ¨¡æ‹Ÿ
            </div>
            <div class="debug-content">
                <div class="test-controls">
                    <button onclick="simulate500Error()" class="btn btn-danger">
                        <i class="fas fa-exclamation-triangle"></i> æ¨¡æ‹Ÿ500é”™è¯¯
                    </button>
                    <button onclick="simulate404Error()" class="btn btn-warning">
                        <i class="fas fa-question-circle"></i> æ¨¡æ‹Ÿ404é”™è¯¯
                    </button>
                    <button onclick="simulateNetworkError()" class="btn btn-dark">
                        <i class="fas fa-wifi"></i> æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯
                    </button>
                </div>
                
                <div id="error-test-output" class="debug-output">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>
        
        <!-- å®æ—¶æ—¥å¿— -->
        <div class="debug-section">
            <div class="debug-header">
                <i class="fas fa-list"></i> å®æ—¶æ—¥å¿—
            </div>
            <div class="debug-content">
                <div class="test-controls">
                    <button onclick="startLogging()" class="btn btn-success">
                        <i class="fas fa-play"></i> å¼€å§‹è®°å½•
                    </button>
                    <button onclick="stopLogging()" class="btn btn-danger">
                        <i class="fas fa-stop"></i> åœæ­¢è®°å½•
                    </button>
                    <button onclick="clearLogs()" class="btn btn-secondary">
                        <i class="fas fa-trash"></i> æ¸…é™¤æ—¥å¿—
                    </button>
                </div>
                
                <div id="real-time-logs" class="debug-output">æ—¥å¿—è®°å½•å·²åœæ­¢</div>
            </div>
        </div>
        
        <!-- è§£å†³æ–¹æ¡ˆå»ºè®® -->
        <div class="debug-section">
            <div class="debug-header">
                <i class="fas fa-lightbulb"></i> è§£å†³æ–¹æ¡ˆå»ºè®®
            </div>
            <div class="debug-content">
                <h5>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š</h5>
                <ul>
                    <li><strong>500é”™è¯¯</strong>: 
                        <ul>
                            <li>æ£€æŸ¥åç«¯Serviceå±‚çš„æšä¸¾è½¬æ¢é€»è¾‘</li>
                            <li>ç¡®è®¤æ•°æ®åº“ä¸­çš„æšä¸¾å€¼æ ¼å¼</li>
                            <li>éªŒè¯Repositoryä¸­çš„æŸ¥è¯¢è¯­å¥</li>
                        </ul>
                    </li>
                    <li><strong>ç­›é€‰æ— ç»“æœ</strong>:
                        <ul>
                            <li>æ£€æŸ¥å‰ç«¯ä¼ é€’çš„å‚æ•°æ ¼å¼</li>
                            <li>ç¡®è®¤åç«¯æ¥æ”¶å‚æ•°çš„å¤§å°å†™</li>
                            <li>éªŒè¯æ•°æ®åº“ä¸­æ˜¯å¦æœ‰å¯¹åº”çŠ¶æ€çš„æ•°æ®</li>
                        </ul>
                    </li>
                    <li><strong>æœç´¢åŠŸèƒ½å¼‚å¸¸</strong>:
                        <ul>
                            <li>æ£€æŸ¥æœç´¢æ¥å£æ˜¯å¦æ­£å¸¸</li>
                            <li>ç¡®è®¤å‰ç«¯ç­›é€‰é€»è¾‘æ˜¯å¦æ­£ç¡®</li>
                            <li>éªŒè¯å…³é”®è¯ç¼–ç é—®é¢˜</li>
                        </ul>
                    </li>
                </ul>
                
                <h5>è°ƒè¯•æ­¥éª¤ï¼š</h5>
                <ol>
                    <li>é¦–å…ˆæµ‹è¯•åŸºç¡€APIæ˜¯å¦æ­£å¸¸</li>
                    <li>ç„¶åæµ‹è¯•å•ä¸ªç­›é€‰æ¡ä»¶</li>
                    <li>æœ€åæµ‹è¯•ç»„åˆç­›é€‰æ¡ä»¶</li>
                    <li>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯</li>
                    <li>æ£€æŸ¥ç½‘ç»œè¯·æ±‚çš„å‚æ•°å’Œå“åº”</li>
                </ol>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        let isLogging = false;
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        
        // é‡å†™consoleæ–¹æ³•æ¥æ•è·æ—¥å¿—
        function startLogging() {
            isLogging = true;
            $('#real-time-logs').text('å¼€å§‹è®°å½•æ—¥å¿—...\n');
            
            console.log = function(...args) {
                originalConsoleLog.apply(console, args);
                if (isLogging) {
                    appendLog('LOG', args.join(' '));
                }
            };
            
            console.error = function(...args) {
                originalConsoleError.apply(console, args);
                if (isLogging) {
                    appendLog('ERROR', args.join(' '));
                }
            };
        }
        
        function stopLogging() {
            isLogging = false;
            console.log = originalConsoleLog;
            console.error = originalConsoleError;
            appendLog('INFO', 'æ—¥å¿—è®°å½•å·²åœæ­¢');
        }
        
        function clearLogs() {
            $('#real-time-logs').text('æ—¥å¿—å·²æ¸…é™¤\n');
        }
        
        function appendLog(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${level}: ${message}\n`;
            $('#real-time-logs').append(logEntry);
            $('#real-time-logs').scrollTop($('#real-time-logs')[0].scrollHeight);
        }
        
        function testBasicAPI() {
            appendOutput('api-test-output', 'æµ‹è¯•åŸºç¡€API...');
            
            $.ajax({
                url: '/api/announcements',
                method: 'GET',
                data: { page: 0, size: 10 },
                success: function(data) {
                    const result = `âœ… åŸºç¡€APIæµ‹è¯•æˆåŠŸ
è¯·æ±‚URL: /api/announcements
å‚æ•°: page=0, size=10
è¿”å›æ•°æ®: ${JSON.stringify(data, null, 2)}`;
                    appendOutput('api-test-output', result);
                },
                error: function(xhr, status, error) {
                    const result = `âŒ åŸºç¡€APIæµ‹è¯•å¤±è´¥
çŠ¶æ€ç : ${xhr.status}
é”™è¯¯: ${error}
å“åº”: ${xhr.responseText}`;
                    appendOutput('api-test-output', result);
                }
            });
        }
        
        function testFilterAPI() {
            appendOutput('api-test-output', 'æµ‹è¯•ç­›é€‰API...');
            
            const testCases = [
                { status: 'PUBLISHED', type: '', desc: 'ä»…çŠ¶æ€ç­›é€‰' },
                { status: '', type: 'ANNOUNCEMENT', desc: 'ä»…ç±»å‹ç­›é€‰' },
                { status: 'PUBLISHED', type: 'ANNOUNCEMENT', desc: 'ç»„åˆç­›é€‰' }
            ];
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    $.ajax({
                        url: '/api/announcements',
                        method: 'GET',
                        data: {
                            page: 0,
                            size: 10,
                            status: testCase.status,
                            type: testCase.type
                        },
                        success: function(data) {
                            const result = `âœ… ${testCase.desc} - æˆåŠŸ
å‚æ•°: status=${testCase.status}, type=${testCase.type}
ç»“æœæ•°é‡: ${data.totalElements || 0}`;
                            appendOutput('api-test-output', result);
                        },
                        error: function(xhr, status, error) {
                            const result = `âŒ ${testCase.desc} - å¤±è´¥
å‚æ•°: status=${testCase.status}, type=${testCase.type}
çŠ¶æ€ç : ${xhr.status}
é”™è¯¯: ${error}`;
                            appendOutput('api-test-output', result);
                        }
                    });
                }, index * 1000);
            });
        }
        
        function testSearchAPI() {
            appendOutput('api-test-output', 'æµ‹è¯•æœç´¢API...');
            
            $.ajax({
                url: '/api/announcements/search',
                method: 'GET',
                data: {
                    page: 0,
                    size: 10,
                    keyword: 'é€šçŸ¥'
                },
                success: function(data) {
                    const result = `âœ… æœç´¢APIæµ‹è¯•æˆåŠŸ
å…³é”®è¯: é€šçŸ¥
ç»“æœæ•°é‡: ${data.totalElements || 0}
è¿”å›æ•°æ®: ${JSON.stringify(data, null, 2)}`;
                    appendOutput('api-test-output', result);
                },
                error: function(xhr, status, error) {
                    const result = `âŒ æœç´¢APIæµ‹è¯•å¤±è´¥
çŠ¶æ€ç : ${xhr.status}
é”™è¯¯: ${error}
å“åº”: ${xhr.responseText}`;
                    appendOutput('api-test-output', result);
                }
            });
        }
        
        function testParameters() {
            const status = $('#test-status').val();
            const type = $('#test-type').val();
            const keyword = $('#test-keyword').val();
            
            appendOutput('param-test-output', `æµ‹è¯•å‚æ•°ç»„åˆ:
çŠ¶æ€: ${status || 'æ— '}
ç±»å‹: ${type || 'æ— '}
å…³é”®è¯: ${keyword || 'æ— '}`);
            
            // å‚æ•°éªŒè¯
            const validStatuses = ['DRAFT', 'PUBLISHED', 'CANCELLED', 'EXPIRED'];
            const validTypes = ['ANNOUNCEMENT', 'ACTIVITY'];
            
            let validationResult = 'å‚æ•°éªŒè¯ç»“æœ:\n';
            
            if (status) {
                if (validStatuses.includes(status)) {
                    validationResult += `âœ… çŠ¶æ€å‚æ•°æœ‰æ•ˆ: ${status}\n`;
                } else {
                    validationResult += `âŒ çŠ¶æ€å‚æ•°æ— æ•ˆ: ${status}\n`;
                }
            }
            
            if (type) {
                if (validTypes.includes(type)) {
                    validationResult += `âœ… ç±»å‹å‚æ•°æœ‰æ•ˆ: ${type}\n`;
                } else {
                    validationResult += `âŒ ç±»å‹å‚æ•°æ— æ•ˆ: ${type}\n`;
                }
            }
            
            if (keyword) {
                validationResult += `âœ… å…³é”®è¯: ${keyword}\n`;
            }
            
            appendOutput('param-test-output', validationResult);
            
            // å®é™…APIæµ‹è¯•
            let url = '/api/announcements';
            let params = { page: 0, size: 10 };
            
            if (status) params.status = status;
            if (type) params.type = type;
            
            if (keyword) {
                url = '/api/announcements/search';
                params.keyword = keyword;
            }
            
            $.ajax({
                url: url,
                method: 'GET',
                data: params,
                success: function(data) {
                    appendOutput('param-test-output', `âœ… APIè°ƒç”¨æˆåŠŸï¼Œè¿”å› ${data.totalElements || 0} æ¡è®°å½•`);
                },
                error: function(xhr, status, error) {
                    appendOutput('param-test-output', `âŒ APIè°ƒç”¨å¤±è´¥: ${xhr.status} - ${error}`);
                }
            });
        }
        
        function simulate500Error() {
            appendOutput('error-test-output', 'æ¨¡æ‹Ÿ500é”™è¯¯...');
            
            $.ajax({
                url: '/api/announcements',
                method: 'GET',
                data: { status: 'INVALID_STATUS' },
                success: function(data) {
                    appendOutput('error-test-output', 'æ„å¤–æˆåŠŸ - åº”è¯¥è¿”å›é”™è¯¯');
                },
                error: function(xhr, status, error) {
                    appendOutput('error-test-output', `æ¨¡æ‹Ÿ500é”™è¯¯ç»“æœ:
çŠ¶æ€ç : ${xhr.status}
é”™è¯¯ç±»å‹: ${status}
é”™è¯¯ä¿¡æ¯: ${error}
å“åº”å†…å®¹: ${xhr.responseText}`);
                }
            });
        }
        
        function simulate404Error() {
            appendOutput('error-test-output', 'æ¨¡æ‹Ÿ404é”™è¯¯...');
            
            $.ajax({
                url: '/api/nonexistent-endpoint',
                method: 'GET',
                success: function(data) {
                    appendOutput('error-test-output', 'æ„å¤–æˆåŠŸ - åº”è¯¥è¿”å›404');
                },
                error: function(xhr, status, error) {
                    appendOutput('error-test-output', `æ¨¡æ‹Ÿ404é”™è¯¯ç»“æœ:
çŠ¶æ€ç : ${xhr.status}
é”™è¯¯ç±»å‹: ${status}
é”™è¯¯ä¿¡æ¯: ${error}`);
                }
            });
        }
        
        function simulateNetworkError() {
            appendOutput('error-test-output', 'æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯...');
            
            $.ajax({
                url: 'http://invalid-domain-that-does-not-exist.com/api',
                method: 'GET',
                timeout: 3000,
                success: function(data) {
                    appendOutput('error-test-output', 'æ„å¤–æˆåŠŸ - åº”è¯¥è¿”å›ç½‘ç»œé”™è¯¯');
                },
                error: function(xhr, status, error) {
                    appendOutput('error-test-output', `æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯ç»“æœ:
çŠ¶æ€ç : ${xhr.status}
é”™è¯¯ç±»å‹: ${status}
é”™è¯¯ä¿¡æ¯: ${error}`);
                }
            });
        }
        
        function appendOutput(elementId, text) {
            const timestamp = new Date().toLocaleTimeString();
            const output = $(`#${elementId}`);
            output.append(`\n[${timestamp}] ${text}\n`);
            output.scrollTop(output[0].scrollHeight);
        }
        
        function clearDebugOutput() {
            $('#api-test-output').text('è¾“å‡ºå·²æ¸…é™¤');
            $('#param-test-output').text('è¾“å‡ºå·²æ¸…é™¤');
            $('#error-test-output').text('è¾“å‡ºå·²æ¸…é™¤');
        }
    </script>
</body>
</html>
