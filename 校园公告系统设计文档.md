# 校园公告系统设计文档

## 第一章 需求分析

### 1.1 系统综合要求

#### 1.1.1 功能需求

本校园公告系统是一个基于Spring Boot 3.5.0的现代化Web应用，旨在为高校提供完整的公告和活动发布管理平台。系统主要功能需求包括：

**用户管理功能**
- 支持四种用户角色：管理员(ADMIN)、教师(TEACHER)、学生(STUDENT)、游客(GUEST)
- 用户注册、登录、权限验证
- 用户信息管理，包括个人资料、头像设置
- 用户状态管理：正常、禁用、待审核、锁定

**公告/活动管理功能**
- 公告和活动的创建、编辑、发布、删除
- 支持富文本编辑器进行内容编辑
- 公告状态管理：草稿、已发布、已过期、已取消
- 重要公告标记和置顶显示
- 公告分类筛选和搜索功能

**互动功能**
- 评论系统：支持对公告/活动进行评论和回复
- 点赞功能：支持对公告和评论进行点赞
- 收藏功能：用户可收藏感兴趣的公告和活动
- 浏览统计：记录公告浏览次数

**权限控制功能**
- 基于角色的访问控制(RBAC)
- 页面级权限控制
- 功能级权限控制
- 数据级权限控制

#### 1.1.2 性能需求

- 系统响应时间：页面加载时间不超过3秒
- 并发用户数：支持500个并发用户同时在线
- 数据库查询优化：复杂查询响应时间不超过2秒
- 分页加载：大数据量列表采用分页机制，每页默认显示10-20条记录

### 1.2 系统数据要求

**数据存储要求**
- 采用MySQL 8.0数据库，支持UTF-8编码
- 数据库连接池配置，支持高并发访问
- 数据备份和恢复机制
- 数据完整性约束和外键关联

**数据安全要求**
- 用户密码加密存储
- 敏感数据传输加密
- SQL注入防护
- XSS攻击防护

### 1.3 逻辑模型

#### 1.3.1 数据流图

```
用户登录 → 身份验证 → 权限检查 → 功能访问
    ↓
公告管理 → 内容编辑 → 状态控制 → 发布展示
    ↓
互动功能 → 评论/点赞/收藏 → 数据统计 → 用户反馈
```

## 第二章 概要设计

### 2.1 系统功能划分

**前端模块**
1. **用户界面层**
   - 登录页面 (index.html)
   - 主控制台 (dashboard.html)
   - 公告列表页 (announcements.html)
   - 公告详情页 (announcement-detail.html)
   - 收藏页面 (favorites.html)

2. **管理界面层**
   - 用户管理 (user-management.html)
   - 公告管理 (announcement-management.html)

**后端模块**
1. **控制器层 (Controller)**
   - AuthController: 用户认证控制器
   - UserController: 用户管理控制器
   - AnnouncementController: 公告管理控制器
   - CommentController: 评论管理控制器
   - LikeController: 点赞管理控制器
   - FavoriteController: 收藏管理控制器

2. **服务层 (Service)**
   - AuthService: 认证服务
   - UserService: 用户服务
   - AnnouncementService: 公告服务
   - CommentService: 评论服务
   - LikeService: 点赞服务
   - FavoriteService: 收藏服务

3. **数据访问层 (Repository)**
   - UserRepository: 用户数据访问
   - AnnouncementRepository: 公告数据访问
   - CommentRepository: 评论数据访问
   - LikeRepository: 点赞数据访问
   - FavoriteRepository: 收藏数据访问

### 2.2 系统结构设计

**技术架构**
```
前端层: HTML5 + CSS3 + JavaScript + jQuery
    ↓
控制器层: Spring Boot Controller
    ↓
服务层: Spring Service + 业务逻辑
    ↓
数据访问层: Spring Data JPA + Hibernate
    ↓
数据库层: MySQL 8.0
```

**部署架构**
```
Nginx (反向代理/负载均衡)
    ↓
Spring Boot Application (端口8081)
    ↓
MySQL Database (端口3307)
```

### 2.3 数据库设计

**核心数据表**

1. **用户表 (users)**
   - 主键: id (BIGINT)
   - 用户名: username (VARCHAR(50), UNIQUE)
   - 邮箱: email (VARCHAR(100))
   - 手机: phone (VARCHAR(20))
   - 密码: password (VARCHAR(255))
   - 角色: role (ENUM: ADMIN, TEACHER, STUDENT, GUEST)
   - 状态: status (ENUM: ACTIVE, INACTIVE, PENDING, LOCKED)
   - 真实姓名: real_name (VARCHAR(100))
   - 学号/工号: student_id (VARCHAR(50))
   - 院系/部门: department (VARCHAR(100))
   - 最后登录时间: last_login_time (DATETIME)
   - 登录次数: login_count (INT)
   - 创建时间: created_at (DATETIME)
   - 更新时间: updated_at (DATETIME)

2. **公告表 (announcements)**
   - 主键: id (BIGINT)
   - 标题: title (VARCHAR(200))
   - 内容: content (TEXT)
   - 类型: type (ENUM: ANNOUNCEMENT, ACTIVITY)
   - 状态: status (ENUM: DRAFT, PUBLISHED, EXPIRED, CANCELLED)
   - 发布时间: publish_time (DATETIME)
   - 截止时间: deadline_time (DATETIME)
   - 发布者: publisher (VARCHAR(100))
   - 摘要: summary (VARCHAR(500))
   - 浏览次数: view_count (INT)
   - 点赞数: like_count (INT)
   - 评论数: comment_count (INT)
   - 收藏数: favorite_count (INT)
   - 是否重要: is_important (BOOLEAN)
   - 创建时间: created_at (DATETIME)
   - 更新时间: updated_at (DATETIME)

3. **评论表 (comments)**
   - 主键: id (BIGINT)
   - 公告ID: announcement_id (BIGINT)
   - 用户ID: user_id (BIGINT)
   - 父评论ID: parent_id (BIGINT)
   - 内容: content (TEXT)
   - 点赞数: like_count (INT)
   - 回复数: reply_count (INT)
   - 是否删除: is_deleted (BOOLEAN)
   - 创建时间: created_at (DATETIME)
   - 更新时间: updated_at (DATETIME)

4. **点赞表 (likes)**
   - 主键: id (BIGINT)
   - 用户ID: user_id (BIGINT)
   - 目标类型: target_type (ENUM: ANNOUNCEMENT, COMMENT)
   - 目标ID: target_id (BIGINT)
   - 创建时间: created_at (DATETIME)

5. **收藏表 (favorites)**
   - 主键: id (BIGINT)
   - 用户ID: user_id (BIGINT)
   - 公告ID: announcement_id (BIGINT)
   - 创建时间: created_at (DATETIME)

**数据表关系**
- users ←→ announcements (一对多：用户可发布多个公告)
- users ←→ comments (一对多：用户可发表多条评论)
- announcements ←→ comments (一对多：公告可有多条评论)
- comments ←→ comments (一对多：评论可有多条回复)
- users ←→ likes (一对多：用户可点赞多个目标)
- users ←→ favorites (一对多：用户可收藏多个公告)

## 第三章 详细设计

### 3.1 前台详细设计

#### 3.1.1 用户认证模块设计

**登录功能设计**
- 页面文件: `index.html`
- 脚本文件: `js/auth.js`
- 样式文件: `css/login.css`

**功能流程:**
1. 用户输入用户名和密码
2. 前端验证输入格式
3. 发送POST请求到 `/api/auth/login`
4. 后端验证用户凭据
5. 验证成功后创建Session
6. 返回用户信息和权限
7. 前端根据角色跳转到相应页面

**权限控制设计**
- 脚本文件: `js/auth-guard.js`
- 页面访问权限配置
- 基于Session的状态维护
- 自动权限检查和页面重定向

#### 3.1.2 公告浏览模块设计

**公告列表页设计**
- 页面文件: `announcements.html`
- 脚本文件: `js/announcements.js`
- 样式文件: `css/announcements.css`

**功能特性:**
1. 分页显示公告列表
2. 按类型筛选（公告/活动）
3. 按状态筛选
4. 关键词搜索
5. 重要公告置顶显示
6. 响应式卡片布局

**公告详情页设计**
- 页面文件: `announcement-detail.html`
- 脚本文件: `js/announcement-detail.js`
- 样式文件: `css/announcement-detail.css`

**功能特性:**
1. 公告内容完整展示
2. 富文本内容渲染
3. 浏览次数统计
4. 点赞功能
5. 收藏功能
6. 评论系统
7. 社交分享

#### 3.1.3 互动功能模块设计

**评论系统设计**
- 支持多级评论回复
- 实时评论加载
- 评论排序（时间/热度）
- 评论点赞功能
- 评论编辑和删除

**收藏功能设计**
- 页面文件: `favorites.html`
- 脚本文件: `js/favorites.js`
- 样式文件: `css/favorites.css`

**功能特性:**
1. 收藏列表展示
2. 按类型筛选收藏
3. 收藏状态切换
4. 批量管理收藏

### 3.2 后台详细设计

#### 3.2.1 用户管理模块设计

**用户管理页设计**
- 页面文件: `user-management.html`
- 脚本文件: `js/user-management.js`
- 样式文件: `css/management.css`

**功能特性:**
1. 用户列表分页显示
2. 用户信息CRUD操作
3. 用户状态管理
4. 角色权限分配
5. 批量操作功能
6. 用户统计信息

**权限控制:**
- 仅管理员可访问
- 操作日志记录
- 数据验证和安全检查

#### 3.2.2 公告管理模块设计

**公告管理页设计**
- 页面文件: `announcement-management.html`
- 脚本文件: `js/announcement-management.js`

**功能特性:**
1. 公告列表管理
2. 富文本编辑器集成
3. 公告状态控制
4. 发布时间设置
5. 重要标记设置
6. 草稿保存功能

**权限控制:**
- 管理员和教师可访问
- 发布权限控制
- 内容审核机制

## 第四章 编码与实现

### 4.1 实现任务和目标

本系统采用现代化的Spring Boot框架进行开发，实现了一个功能完整、性能优良的校园公告管理系统。主要实现目标包括：

1. **技术目标**
   - 基于Spring Boot 3.5.0构建RESTful API
   - 采用Spring Data JPA进行数据持久化
   - 使用MySQL 8.0作为数据存储
   - 前端采用原生JavaScript + jQuery实现
   - 支持Docker容器化部署

2. **功能目标**
   - 完整的用户管理和权限控制系统
   - 灵活的公告/活动发布和管理功能
   - 丰富的互动功能（评论、点赞、收藏）
   - 响应式的用户界面设计
   - 高性能的数据查询和分页

3. **质量目标**
   - 代码结构清晰，遵循MVC设计模式
   - 数据库设计规范，支持高并发访问
   - 前端界面友好，用户体验良好
   - 系统安全可靠，数据完整性保证

### 4.2 开发技术环境的搭建

#### 4.2.1 系统基本工作流程

**后端工作流程:**
```
HTTP请求 → Spring Boot Controller → Service业务层 → Repository数据层 → MySQL数据库
    ↓
数据返回 ← JSON响应 ← 业务处理 ← JPA查询 ← 数据库结果
```

**前端工作流程:**
```
用户操作 → JavaScript事件 → AJAX请求 → 后端API → 数据处理 → DOM更新 → 界面刷新
```

**权限控制流程:**
```
页面访问 → 权限检查 → Session验证 → 角色判断 → 功能授权 → 页面渲染
```

#### 4.2.2 Spring Boot环境的结构

**项目结构:**
```
src/
├── main/
│   ├── java/com/hello/
│   │   ├── HelloApplication.java          # 主应用类
│   │   ├── controller/                    # 控制器层
│   │   │   ├── AuthController.java        # 认证控制器
│   │   │   ├── UserController.java        # 用户管理控制器
│   │   │   ├── AnnouncementController.java # 公告管理控制器
│   │   │   ├── CommentController.java     # 评论控制器
│   │   │   ├── LikeController.java        # 点赞控制器
│   │   │   └── FavoriteController.java    # 收藏控制器
│   │   ├── service/                       # 服务层
│   │   │   ├── AuthService.java           # 认证服务
│   │   │   ├── UserService.java           # 用户服务
│   │   │   ├── AnnouncementService.java   # 公告服务
│   │   │   ├── CommentService.java        # 评论服务
│   │   │   ├── LikeService.java           # 点赞服务
│   │   │   └── FavoriteService.java       # 收藏服务
│   │   ├── entity/                        # 实体类
│   │   │   ├── User.java                  # 用户实体
│   │   │   ├── Announcement.java          # 公告实体
│   │   │   ├── Comment.java               # 评论实体
│   │   │   ├── Like.java                  # 点赞实体
│   │   │   └── Favorite.java              # 收藏实体
│   │   └── repository/                    # 数据访问层
│   │       ├── UserRepository.java        # 用户数据访问
│   │       ├── AnnouncementRepository.java # 公告数据访问
│   │       ├── CommentRepository.java     # 评论数据访问
│   │       ├── LikeRepository.java        # 点赞数据访问
│   │       └── FavoriteRepository.java    # 收藏数据访问
│   └── resources/
│       ├── application.properties         # 应用配置
│       ├── application-docker.properties  # Docker环境配置
│       ├── database-setup.sql            # 数据库初始化脚本
│       └── static/                       # 静态资源
│           ├── css/                      # 样式文件
│           ├── js/                       # JavaScript文件
│           ├── images/                   # 图片资源
│           └── *.html                    # HTML页面
```

#### 4.2.3 相关的配置文件

**1. 主配置文件 (application.properties)**
```properties
# 应用程序配置
spring.application.name=hello
server.port=8080

# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/hello_db_dev?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=UTF-8
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA/Hibernate 配置
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=false

# 编码配置
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# 日志配置
logging.level.com.hello=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
```

**2. Docker环境配置 (application-docker.properties)**
```properties
# Docker 环境专用配置
spring.application.name=campus-announcement-system
server.port=8081

# 数据库配置 - Docker 环境
spring.datasource.url=jdbc:mysql://mysql:3306/hello_db_dev?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=UTF-8
spring.datasource.username=campus_user
spring.datasource.password=campus_pass_2024

# JPA 配置
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
```

**3. Maven配置 (pom.xml)**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.0</version>
    </parent>

    <groupId>com.duan</groupId>
    <artifactId>hello</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>hello</name>

    <properties>
        <java.version>17</java.version>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>

    <dependencies>
        <!-- Spring Boot Web Starter -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- Spring Boot Data JPA -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <!-- MySQL Connector -->
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- Spring Boot Actuator -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
    </dependencies>
</project>
```

**4. Docker配置 (docker-compose.yml)**
```yaml
version: '3.8'

services:
  # MySQL 数据库服务
  mysql:
    image: mysql:8.0
    container_name: campus-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: campus_root_2024
      MYSQL_DATABASE: hello_db_dev
      MYSQL_USER: campus_user
      MYSQL_PASSWORD: campus_pass_2024
      TZ: Asia/Shanghai
    ports:
      - "3307:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./docker/mysql/conf.d:/etc/mysql/conf.d:ro
      - ./docker/mysql/init:/docker-entrypoint-initdb.d:ro

  # Spring Boot 应用服务
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: campus-app
    restart: unless-stopped
    environment:
      DB_HOST: mysql
      DB_PORT: 3306
      DB_NAME: hello_db_dev
      DB_USERNAME: campus_user
      DB_PASSWORD: campus_pass_2024
      SERVER_PORT: 8081
      SPRING_PROFILES_ACTIVE: docker
    ports:
      - "8081:8081"
    depends_on:
      - mysql
    volumes:
      - ./logs:/app/logs

  # Nginx 反向代理
  nginx:
    image: nginx:alpine
    container_name: campus-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./docker/nginx/ssl:/etc/nginx/ssl:ro
    depends_on:
      - app

volumes:
  mysql_data:
```

### 4.3 前台编码与实现

#### 4.3.1 主页的编码与实现

**登录页面实现 (index.html)**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校园公告系统 - 登录</title>
    <link rel="stylesheet" href="css/login.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h2>校园公告系统</h2>
            <form id="login-form">
                <div class="input-group">
                    <input type="text" id="username" placeholder="用户名" required>
                </div>
                <div class="input-group">
                    <input type="password" id="password" placeholder="密码" required>
                </div>
                <button type="submit" class="login-btn">登录</button>
            </form>
            <div class="test-accounts">
                <h4>测试账号</h4>
                <p>管理员: admin / 123</p>
                <p>教师: teacher / 123</p>
                <p>学生: student / 123</p>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/auth.js"></script>
</body>
</html>
```

**登录功能JavaScript实现 (js/auth.js)**
```javascript
$(document).ready(function() {
    // 检查是否已登录
    checkLoginStatus();

    // 绑定登录表单提交事件
    $('#login-form').submit(function(e) {
        e.preventDefault();
        login();
    });

    function login() {
        const username = $('#username').val().trim();
        const password = $('#password').val().trim();

        if (!username || !password) {
            showMessage('请输入用户名和密码', 'error');
            return;
        }

        $.ajax({
            url: '/api/auth/login',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                username: username,
                password: password
            }),
            success: function(response) {
                if (response.success) {
                    showMessage('登录成功', 'success');
                    // 存储用户信息到localStorage
                    localStorage.setItem('currentUser', JSON.stringify(response.user));
                    // 根据角色跳转到相应页面
                    redirectToRolePage(response.user.role);
                } else {
                    showMessage(response.message || '登录失败', 'error');
                }
            },
            error: function(xhr, status, error) {
                showMessage('登录失败，请检查网络连接', 'error');
            }
        });
    }

    function redirectToRolePage(role) {
        switch(role) {
            case 'ADMIN':
                window.location.href = 'dashboard.html';
                break;
            case 'TEACHER':
                window.location.href = 'dashboard.html';
                break;
            case 'STUDENT':
                window.location.href = 'announcements.html';
                break;
            default:
                window.location.href = 'announcements.html';
        }
    }
});
```

#### 4.3.2 公告浏览的编码与实现

**公告列表页面实现 (announcements.html)**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校园公告 - 校园管理系统</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/announcements.css">
</head>
<body>
    <!-- 侧边栏导航 -->
    <nav id="sidebar">
        <div class="profile-container">
            <div class="profile-image">
                <img alt="个人头像" id="sidebar-avatar">
            </div>
            <h3 class="name">用户名</h3>
            <p class="profession">角色信息</p>
        </div>
        <ul class="nav-links">
            <li><a href="dashboard.html"><i class="fas fa-home"></i> 首页</a></li>
            <li><a href="announcements.html" class="active"><i class="fas fa-bullhorn"></i> 校园公告</a></li>
            <li><a href="announcements.html?type=activity"><i class="fas fa-calendar-alt"></i> 校园活动</a></li>
            <li><a href="favorites.html"><i class="fas fa-heart"></i> 我的收藏</a></li>
            <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> 退出登录</a></li>
        </ul>
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <div class="content-header">
            <h1 id="page-title-text">校园公告</h1>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="搜索公告...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>
        </div>

        <!-- 筛选器 -->
        <div class="filters">
            <select id="type-filter">
                <option value="">全部类型</option>
                <option value="ANNOUNCEMENT">公告</option>
                <option value="ACTIVITY">活动</option>
            </select>
            <select id="status-filter">
                <option value="">全部状态</option>
                <option value="PUBLISHED">已发布</option>
                <option value="EXPIRED">已过期</option>
            </select>
            <button id="clear-filters">清除筛选</button>
        </div>

        <!-- 重要公告区域 -->
        <section id="important-section" class="important-section">
            <h2>重要公告</h2>
            <div id="important-announcements" class="important-grid"></div>
        </section>

        <!-- 公告列表区域 -->
        <section class="announcements-section">
            <h2 id="section-title-text">所有公告</h2>
            <div id="announcements-grid" class="announcements-grid"></div>

            <!-- 分页控件 -->
            <div class="pagination-container">
                <div id="pagination" class="pagination"></div>
            </div>
        </section>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/auth-guard.js"></script>
    <script src="js/avatar-utils.js"></script>
    <script src="js/announcements.js"></script>
</body>
</html>
```

**公告列表JavaScript实现 (js/announcements.js)**
```javascript
$(document).ready(function() {
    let currentPage = 0;
    let pageSize = 12;
    let currentType = '';
    let currentStatus = '';
    let currentKeyword = '';
    let currentUser = null;

    function init() {
        // 从URL参数获取类型
        const urlParams = new URLSearchParams(window.location.search);
        const typeParam = urlParams.get('type');

        if (typeParam === 'activity') {
            currentType = 'ACTIVITY';
            $('#type-filter').val('ACTIVITY');
            $('#page-title-text').text('校园活动');
            $('#section-title-text').text('所有活动');
        }

        // 获取当前用户信息
        currentUser = getCurrentUser();

        // 更新侧边栏头像
        if (typeof AvatarUtils !== 'undefined') {
            AvatarUtils.updateSidebarAvatar(currentUser);
        }

        // 绑定事件
        bindEvents();

        // 加载数据
        loadImportantAnnouncements();
        loadAnnouncements();
    }

    function bindEvents() {
        // 搜索功能
        $('#search-btn').click(performSearch);
        $('#search-input').keypress(function(e) {
            if (e.which === 13) performSearch();
        });

        // 筛选功能
        $('#type-filter, #status-filter').change(function() {
            currentPage = 0;
            loadAnnouncements();
        });

        // 清除筛选
        $('#clear-filters').click(function() {
            $('#type-filter').val('');
            $('#status-filter').val('');
            $('#search-input').val('');
            currentType = '';
            currentStatus = '';
            currentKeyword = '';
            currentPage = 0;
            loadAnnouncements();
        });
    }

    function loadAnnouncements() {
        const params = {
            page: currentPage,
            size: pageSize
        };

        // 添加筛选参数
        if ($('#type-filter').val()) params.type = $('#type-filter').val();
        if ($('#status-filter').val()) params.status = $('#status-filter').val();
        if ($('#search-input').val().trim()) params.keyword = $('#search-input').val().trim();

        $.ajax({
            url: '/api/announcements',
            method: 'GET',
            data: params,
            success: function(data) {
                renderAnnouncements(data.content);
                renderPagination(data);
            },
            error: function(xhr, status, error) {
                console.error('加载公告失败:', error);
                showMessage('加载公告失败，请稍后重试', 'error');
            }
        });
    }

    function renderAnnouncements(announcements) {
        const container = $('#announcements-grid');
        container.empty();

        if (announcements.length === 0) {
            container.html('<div class="empty-state">暂无公告</div>');
            return;
        }

        announcements.forEach(function(announcement) {
            const card = createAnnouncementCard(announcement);
            container.append(card);
        });
    }

    function createAnnouncementCard(announcement) {
        const typeClass = announcement.type === 'ACTIVITY' ? 'activity' : 'announcement';
        const statusClass = announcement.status.toLowerCase();

        return $(`
            <div class="announcement-card ${typeClass} ${statusClass}" data-id="${announcement.id}">
                <div class="card-header">
                    <span class="type-badge">${getTypeDisplayName(announcement.type)}</span>
                    <span class="status-badge">${getStatusDisplayName(announcement.status)}</span>
                </div>
                <h3 class="card-title">${escapeHtml(announcement.title)}</h3>
                <p class="card-summary">${escapeHtml(announcement.summary || '')}</p>
                <div class="card-meta">
                    <span class="publish-time">${formatDate(announcement.publishTime)}</span>
                    <span class="publisher">${escapeHtml(announcement.publisher || '')}</span>
                </div>
                <div class="card-stats">
                    <span><i class="fas fa-eye"></i> ${announcement.viewCount}</span>
                    <span><i class="fas fa-heart"></i> ${announcement.likeCount}</span>
                    <span><i class="fas fa-comment"></i> ${announcement.commentCount}</span>
                </div>
            </div>
        `).click(function() {
            window.location.href = `announcement-detail.html?id=${announcement.id}`;
        });
    }

    // 初始化页面
    init();
});
```

#### 4.3.3 公告详情的编码与实现

**公告详情页面实现 (announcement-detail.html)**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公告详情 - 校园管理系统</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/announcement-detail.css">
</head>
<body>
    <!-- 侧边栏导航 -->
    <nav id="sidebar">
        <!-- 侧边栏内容同公告列表页 -->
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 公告详情区域 -->
        <article class="announcement-detail">
            <header class="announcement-header">
                <div class="breadcrumb">
                    <a href="announcements.html">公告列表</a> >
                    <span id="announcement-type-breadcrumb">公告详情</span>
                </div>
                <h1 id="announcement-title">加载中...</h1>
                <div class="announcement-meta">
                    <span class="type-badge" id="announcement-type-badge"></span>
                    <span class="status-badge" id="announcement-status-badge"></span>
                    <span class="publish-time" id="announcement-publish-time"></span>
                    <span class="publisher" id="announcement-publisher"></span>
                </div>
            </header>

            <div class="announcement-content">
                <div id="announcement-content-body">加载中...</div>
            </div>

            <!-- 互动区域 -->
            <div class="announcement-actions">
                <button class="action-btn like-btn" id="like-btn">
                    <i class="fas fa-heart"></i>
                    <span id="announcement-likes">0</span>
                </button>
                <button class="action-btn favorite-btn" id="favorite-btn">
                    <i class="fas fa-bookmark"></i>
                    收藏
                </button>
                <button class="action-btn comment-btn" id="comment-btn">
                    <i class="fas fa-comment"></i>
                    <span id="announcement-comments">0</span>
                </button>
                <span class="view-count">
                    <i class="fas fa-eye"></i>
                    <span id="announcement-views">0</span>
                </span>
            </div>
        </article>

        <!-- 评论区域 -->
        <section class="comments-section">
            <h3>评论 (<span id="comment-count">0</span>)</h3>

            <!-- 发表评论 -->
            <div class="comment-form" id="comment-form">
                <textarea id="comment-input" placeholder="发表你的看法..."></textarea>
                <div class="comment-actions">
                    <button class="btn btn-primary" onclick="submitComment()">发表评论</button>
                    <button class="btn btn-secondary" onclick="cancelComment()">取消</button>
                </div>
            </div>

            <!-- 评论列表 -->
            <div class="comments-list" id="comments-list">
                <!-- 评论内容将通过JavaScript动态加载 -->
            </div>

            <!-- 加载更多 -->
            <div class="load-more-container">
                <button class="btn btn-outline" id="load-more-comments">加载更多评论</button>
            </div>
        </section>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/auth-guard.js"></script>
    <script src="js/avatar-utils.js"></script>
    <script src="js/announcement-detail.js"></script>
</body>
</html>
```

#### 4.3.4 收藏功能的编码与实现

**收藏页面实现 (favorites.html)**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的收藏 - 校园管理系统</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/favorites.css">
</head>
<body>
    <!-- 侧边栏导航 -->
    <nav id="sidebar">
        <!-- 侧边栏内容 -->
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <div class="content-header">
            <h1>我的收藏</h1>
            <div class="stats-container">
                <div class="stat-item">
                    <span class="stat-number" id="total-favorites">0</span>
                    <span class="stat-label">总收藏</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="announcement-favorites">0</span>
                    <span class="stat-label">公告</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="activity-favorites">0</span>
                    <span class="stat-label">活动</span>
                </div>
            </div>
        </div>

        <!-- 筛选和排序 -->
        <div class="filters">
            <select id="type-filter">
                <option value="">全部类型</option>
                <option value="ANNOUNCEMENT">公告</option>
                <option value="ACTIVITY">活动</option>
            </select>
            <select id="sort-filter">
                <option value="createdAt">收藏时间</option>
                <option value="publishTime">发布时间</option>
                <option value="viewCount">浏览量</option>
            </select>
        </div>

        <!-- 收藏列表 -->
        <div class="favorites-container">
            <div id="favorites-grid" class="favorites-grid"></div>

            <!-- 分页控件 -->
            <div class="pagination-container">
                <div id="pagination" class="pagination"></div>
            </div>
        </div>

        <!-- 空状态 -->
        <div id="empty-state" class="empty-state" style="display: none;">
            <i class="fas fa-heart-broken"></i>
            <h3>暂无收藏</h3>
            <p>去<a href="announcements.html">公告列表</a>收藏一些感兴趣的内容吧</p>
        </div>

        <!-- 加载状态 -->
        <div id="loading" class="loading" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i>
            <p>加载中...</p>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/auth-guard.js"></script>
    <script src="js/avatar-utils.js"></script>
    <script src="js/favorites.js"></script>
</body>
</html>
```

**收藏功能JavaScript实现 (js/favorites.js)**
```javascript
$(document).ready(function() {
    let currentUser = null;
    let currentPage = 0;
    let pageSize = 12;
    let currentFilter = '';
    let currentSort = 'createdAt';

    // 等待权限检查完成后初始化
    $(document).on('pageInitialized', function(event, user) {
        if (user) {
            currentUser = user;
            init();
        }
    });

    function init() {
        // 更新侧边栏头像
        if (typeof AvatarUtils !== 'undefined') {
            AvatarUtils.updateSidebarAvatar(currentUser);
        }

        // 绑定事件
        bindEvents();

        // 加载收藏数据
        loadFavorites();

        // 加载统计数据
        loadStats();
    }

    function bindEvents() {
        // 筛选和排序
        $('#type-filter').change(function() {
            currentFilter = $(this).val();
            currentPage = 0;
            loadFavorites();
        });

        $('#sort-filter').change(function() {
            currentSort = $(this).val();
            currentPage = 0;
            loadFavorites();
        });
    }

    function loadFavorites() {
        showLoading();

        const params = {
            page: currentPage,
            size: pageSize,
            sort: currentSort
        };

        if (currentFilter) {
            params.type = currentFilter;
        }

        $.ajax({
            url: '/api/favorites/user/' + currentUser.id + '/announcements/details',
            method: 'GET',
            data: params,
            success: function(data) {
                hideLoading();
                renderFavorites(data.content);
                updatePagination(data);
            },
            error: function(xhr, status, error) {
                hideLoading();
                console.error('加载收藏列表失败:', error);
                showMessage('加载收藏列表失败，请稍后重试', 'error');
                showEmptyState();
            }
        });
    }

    function renderFavorites(favorites) {
        const container = $('#favorites-grid');
        container.empty();

        if (favorites.length === 0) {
            showEmptyState();
            return;
        }

        hideEmptyState();

        favorites.forEach(function(favorite) {
            const card = createFavoriteCard(favorite);
            container.append(card);
        });
    }

    function createFavoriteCard(favorite) {
        const announcement = favorite.announcement;
        const typeClass = announcement.type === 'ACTIVITY' ? 'activity' : 'announcement';

        return $(`
            <div class="favorite-card ${typeClass}" data-id="${announcement.id}">
                <div class="card-header">
                    <span class="type-badge">${getTypeDisplayName(announcement.type)}</span>
                    <button class="unfavorite-btn" onclick="toggleFavorite(${announcement.id})">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
                <h3 class="card-title">${escapeHtml(announcement.title)}</h3>
                <p class="card-summary">${escapeHtml(announcement.summary || '')}</p>
                <div class="card-meta">
                    <span class="publish-time">发布: ${formatDate(announcement.publishTime)}</span>
                    <span class="favorite-time">收藏: ${formatDate(favorite.createdAt)}</span>
                </div>
                <div class="card-stats">
                    <span><i class="fas fa-eye"></i> ${announcement.viewCount}</span>
                    <span><i class="fas fa-heart"></i> ${announcement.likeCount}</span>
                    <span><i class="fas fa-comment"></i> ${announcement.commentCount}</span>
                </div>
            </div>
        `).click(function(e) {
            if (!$(e.target).closest('.unfavorite-btn').length) {
                window.location.href = `announcement-detail.html?id=${announcement.id}`;
            }
        });
    }

    // 全局函数供HTML调用
    window.toggleFavorite = function(announcementId) {
        $.ajax({
            url: '/api/favorites',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                userId: currentUser.id,
                announcementId: announcementId
            }),
            success: function(response) {
                showMessage('已取消收藏', 'success');
                loadFavorites(); // 重新加载列表
                loadStats(); // 更新统计
            },
            error: function(xhr, status, error) {
                showMessage('操作失败，请稍后重试', 'error');
            }
        });
    };

    function loadStats() {
        $.ajax({
            url: '/api/favorites/user/' + currentUser.id + '/stats',
            method: 'GET',
            success: function(stats) {
                $('#total-favorites').text(stats.total || 0);
                $('#announcement-favorites').text(stats.announcements || 0);
                $('#activity-favorites').text(stats.activities || 0);
            },
            error: function(xhr, status, error) {
                console.error('加载统计数据失败:', error);
            }
        });
    }
});
```

### 4.4 后台编码与实现

#### 4.4.1 后台登录模块的编码与实现

**认证控制器实现 (AuthController.java)**
```java
@RestController
@RequestMapping("/api/auth")
@CrossOrigin(origins = "*")
public class AuthController {

    @Autowired
    private AuthService authService;

    /**
     * 用户登录
     */
    @PostMapping("/login")
    public ResponseEntity<Map<String, Object>> login(
            @RequestBody LoginRequest loginRequest,
            HttpSession session) {

        Map<String, Object> response = new HashMap<>();

        try {
            AuthService.LoginResult result = authService.login(
                loginRequest.getUsername(),
                loginRequest.getPassword()
            );

            if (result.isSuccess()) {
                User user = result.getUser();

                // 将用户信息存储到session中
                session.setAttribute("currentUser", user);
                session.setAttribute("userId", user.getId());
                session.setAttribute("username", user.getUsername());
                session.setAttribute("userRole", user.getRole().name());

                response.put("success", true);
                response.put("message", "登录成功");
                response.put("user", createUserResponse(user));

                return ResponseEntity.ok(response);
            } else {
                response.put("success", false);
                response.put("message", result.getMessage());
                return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(response);
            }
        } catch (Exception e) {
            response.put("success", false);
            response.put("message", "登录失败，请稍后重试");
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
        }
    }

    /**
     * 用户登出
     */
    @PostMapping("/logout")
    public ResponseEntity<Map<String, Object>> logout(HttpSession session) {
        Map<String, Object> response = new HashMap<>();

        try {
            session.invalidate();
            response.put("success", true);
            response.put("message", "登出成功");
            return ResponseEntity.ok(response);
        } catch (Exception e) {
            response.put("success", false);
            response.put("message", "登出失败");
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
        }
    }

    /**
     * 获取当前用户信息
     */
    @GetMapping("/current")
    public ResponseEntity<Map<String, Object>> getCurrentUser(HttpSession session) {
        Map<String, Object> response = new HashMap<>();

        User currentUser = (User) session.getAttribute("currentUser");
        if (currentUser != null) {
            response.put("success", true);
            response.put("user", createUserResponse(currentUser));
        } else {
            response.put("success", false);
            response.put("message", "用户未登录");
        }

        return ResponseEntity.ok(response);
    }

    private Map<String, Object> createUserResponse(User user) {
        Map<String, Object> userResponse = new HashMap<>();
        userResponse.put("id", user.getId());
        userResponse.put("username", user.getUsername());
        userResponse.put("email", user.getEmail());
        userResponse.put("role", user.getRole().name());
        userResponse.put("status", user.getStatus().name());
        userResponse.put("realName", user.getRealName());
        userResponse.put("department", user.getDepartment());
        return userResponse;
    }
}
```

#### 4.4.2 后台管理主页模块的编码与实现

**主控制台页面实现 (dashboard.html)**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理控制台 - 校园管理系统</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <!-- 侧边栏导航 -->
    <nav id="sidebar">
        <!-- 侧边栏内容 -->
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <div class="dashboard-header">
            <h1>管理控制台</h1>
            <div class="datetime-display">
                <span id="current-time"></span>
                <span id="current-date"></span>
            </div>
        </div>

        <!-- 统计卡片 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-users">0</h3>
                    <p>总用户数</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-bullhorn"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-announcements">0</h3>
                    <p>总公告数</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-activities">0</h3>
                    <p>总活动数</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-comments">0</h3>
                    <p>总评论数</p>
                </div>
            </div>
        </div>

        <!-- 最新公告 -->
        <section class="recent-announcements">
            <h2>最新公告</h2>
            <div id="recent-announcements-list" class="announcements-list">
                <!-- 动态加载内容 -->
            </div>
        </section>

        <!-- 快速操作 -->
        <section class="quick-actions">
            <h2>快速操作</h2>
            <div class="actions-grid">
                <a href="announcement-management.html" class="action-card">
                    <i class="fas fa-plus"></i>
                    <span>发布公告</span>
                </a>
                <a href="user-management.html" class="action-card">
                    <i class="fas fa-user-plus"></i>
                    <span>用户管理</span>
                </a>
                <a href="announcements.html" class="action-card">
                    <i class="fas fa-list"></i>
                    <span>查看公告</span>
                </a>
            </div>
        </section>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/auth-guard.js"></script>
    <script src="js/avatar-utils.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>
```

#### 4.4.3 后台公告信息发布的编码与实现

**公告管理控制器实现 (AnnouncementController.java)**
```java
@RestController
@RequestMapping("/api/announcements")
@CrossOrigin(origins = "*")
public class AnnouncementController {

    @Autowired
    private AnnouncementService announcementService;

    /**
     * 获取所有公告/活动（分页，支持筛选）
     */
    @GetMapping
    public ResponseEntity<Page<Announcement>> getAllAnnouncements(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "10") int size,
            @RequestParam(required = false) String status,
            @RequestParam(required = false) String type) {
        try {
            Page<Announcement> announcements = announcementService.getAllAnnouncements(page, size, status, type);
            return ResponseEntity.ok(announcements);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 根据ID获取公告详情
     */
    @GetMapping("/{id}")
    public ResponseEntity<Announcement> getAnnouncementById(@PathVariable Long id) {
        try {
            Optional<Announcement> announcement = announcementService.getAnnouncementById(id);
            if (announcement.isPresent()) {
                // 增加浏览次数
                announcementService.incrementViewCount(id);
                return ResponseEntity.ok(announcement.get());
            } else {
                return ResponseEntity.notFound().build();
            }
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 创建新公告
     */
    @PostMapping
    public ResponseEntity<Announcement> createAnnouncement(@RequestBody Announcement announcement) {
        try {
            Announcement savedAnnouncement = announcementService.saveAnnouncement(announcement);
            return ResponseEntity.status(HttpStatus.CREATED).body(savedAnnouncement);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 更新公告
     */
    @PutMapping("/{id}")
    public ResponseEntity<Announcement> updateAnnouncement(
            @PathVariable Long id,
            @RequestBody Announcement announcement) {
        try {
            announcement.setId(id);
            Announcement updatedAnnouncement = announcementService.saveAnnouncement(announcement);
            return ResponseEntity.ok(updatedAnnouncement);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 发布公告
     */
    @PutMapping("/{id}/publish")
    public ResponseEntity<Announcement> publishAnnouncement(@PathVariable Long id) {
        try {
            Announcement announcement = announcementService.publishAnnouncement(id);
            return ResponseEntity.ok(announcement);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 取消发布公告
     */
    @PutMapping("/{id}/cancel")
    public ResponseEntity<Announcement> cancelAnnouncement(@PathVariable Long id) {
        try {
            Announcement announcement = announcementService.cancelAnnouncement(id);
            return ResponseEntity.ok(announcement);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 删除公告
     */
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteAnnouncement(@PathVariable Long id) {
        try {
            announcementService.deleteAnnouncement(id);
            return ResponseEntity.noContent().build();
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 获取重要公告
     */
    @GetMapping("/important")
    public ResponseEntity<List<Announcement>> getImportantAnnouncements() {
        try {
            List<Announcement> announcements = announcementService.getImportantAnnouncements();
            return ResponseEntity.ok(announcements);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }
}
```

**公告服务层实现 (AnnouncementService.java)**
```java
@Service
@Transactional
public class AnnouncementService {

    @Autowired
    private AnnouncementRepository announcementRepository;

    /**
     * 获取所有公告（分页和筛选）
     */
    public Page<Announcement> getAllAnnouncements(int page, int size, String status, String type) {
        Pageable pageable = PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, "publishTime"));

        if (status != null && type != null) {
            return announcementRepository.findByStatusAndType(
                Announcement.AnnouncementStatus.valueOf(status),
                Announcement.AnnouncementType.valueOf(type),
                pageable
            );
        } else if (status != null) {
            return announcementRepository.findByStatus(
                Announcement.AnnouncementStatus.valueOf(status),
                pageable
            );
        } else if (type != null) {
            return announcementRepository.findByType(
                Announcement.AnnouncementType.valueOf(type),
                pageable
            );
        } else {
            return announcementRepository.findAll(pageable);
        }
    }

    /**
     * 根据ID获取公告
     */
    public Optional<Announcement> getAnnouncementById(Long id) {
        return announcementRepository.findById(id);
    }

    /**
     * 保存公告
     */
    public Announcement saveAnnouncement(Announcement announcement) {
        if (announcement.getId() == null) {
            // 新建公告
            announcement.setCreatedAt(LocalDateTime.now());
        }
        announcement.setUpdatedAt(LocalDateTime.now());
        return announcementRepository.save(announcement);
    }

    /**
     * 发布公告
     */
    public Announcement publishAnnouncement(Long id) {
        Optional<Announcement> optionalAnnouncement = announcementRepository.findById(id);
        if (optionalAnnouncement.isPresent()) {
            Announcement announcement = optionalAnnouncement.get();
            announcement.setStatus(Announcement.AnnouncementStatus.PUBLISHED);
            announcement.setPublishTime(LocalDateTime.now());
            return announcementRepository.save(announcement);
        }
        throw new RuntimeException("公告不存在");
    }

    /**
     * 取消发布公告
     */
    public Announcement cancelAnnouncement(Long id) {
        Optional<Announcement> optionalAnnouncement = announcementRepository.findById(id);
        if (optionalAnnouncement.isPresent()) {
            Announcement announcement = optionalAnnouncement.get();
            announcement.setStatus(Announcement.AnnouncementStatus.CANCELLED);
            return announcementRepository.save(announcement);
        }
        throw new RuntimeException("公告不存在");
    }

    /**
     * 删除公告
     */
    public void deleteAnnouncement(Long id) {
        announcementRepository.deleteById(id);
    }

    /**
     * 增加浏览次数
     */
    public void incrementViewCount(Long id) {
        Optional<Announcement> optionalAnnouncement = announcementRepository.findById(id);
        if (optionalAnnouncement.isPresent()) {
            Announcement announcement = optionalAnnouncement.get();
            announcement.incrementViewCount();
            announcementRepository.save(announcement);
        }
    }

    /**
     * 获取重要公告
     */
    public List<Announcement> getImportantAnnouncements() {
        return announcementRepository.findByIsImportantTrueAndStatusOrderByPublishTimeDesc(
            Announcement.AnnouncementStatus.PUBLISHED
        );
    }

    /**
     * 搜索公告
     */
    public Page<Announcement> searchAnnouncements(String keyword, int page, int size) {
        Pageable pageable = PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, "publishTime"));
        return announcementRepository.findByTitleContainingOrContentContaining(keyword, keyword, pageable);
    }
}
```

#### 4.4.4 用户管理信息的编码与实现

**用户管理控制器实现 (UserController.java)**
```java
@RestController
@RequestMapping("/api/users")
@CrossOrigin(origins = "*")
public class UserController {

    @Autowired
    private UserService userService;

    /**
     * 获取所有用户（分页）
     */
    @GetMapping
    public ResponseEntity<Page<User>> getAllUsers(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "10") int size,
            @RequestParam(required = false) String role,
            @RequestParam(required = false) String status,
            @RequestParam(required = false) String keyword) {
        try {
            Page<User> users = userService.getAllUsers(page, size, role, status, keyword);
            return ResponseEntity.ok(users);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 根据ID获取用户
     */
    @GetMapping("/{id}")
    public ResponseEntity<User> getUserById(@PathVariable Long id) {
        try {
            Optional<User> user = userService.getUserById(id);
            return user.map(ResponseEntity::ok).orElse(ResponseEntity.notFound().build());
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 创建新用户
     */
    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody User user) {
        try {
            User savedUser = userService.saveUser(user);
            return ResponseEntity.status(HttpStatus.CREATED).body(savedUser);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 更新用户
     */
    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(@PathVariable Long id, @RequestBody User user) {
        try {
            user.setId(id);
            User updatedUser = userService.saveUser(user);
            return ResponseEntity.ok(updatedUser);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 删除用户
     */
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        try {
            userService.deleteUser(id);
            return ResponseEntity.noContent().build();
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 获取用户统计信息
     */
    @GetMapping("/statistics")
    public ResponseEntity<Map<String, Object>> getUserStatistics() {
        try {
            Map<String, Object> statistics = userService.getUserStatistics();
            return ResponseEntity.ok(statistics);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }
}
```

#### 4.4.5 评论和互动功能管理的编码与实现

**评论管理控制器实现 (CommentController.java)**
```java
@RestController
@RequestMapping("/api/comments")
@CrossOrigin(origins = "*")
public class CommentController {

    @Autowired
    private CommentService commentService;

    /**
     * 获取公告的评论列表
     */
    @GetMapping("/announcement/{announcementId}")
    public ResponseEntity<Page<Comment>> getCommentsByAnnouncement(
            @PathVariable Long announcementId,
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "10") int size,
            @RequestParam(defaultValue = "createdAt") String sortBy) {
        try {
            Page<Comment> comments = commentService.getCommentsByAnnouncement(announcementId, page, size, sortBy);
            return ResponseEntity.ok(comments);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 发表评论
     */
    @PostMapping
    public ResponseEntity<Comment> createComment(@RequestBody Comment comment) {
        try {
            Comment savedComment = commentService.saveComment(comment);
            return ResponseEntity.status(HttpStatus.CREATED).body(savedComment);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 更新评论
     */
    @PutMapping("/{id}")
    public ResponseEntity<Comment> updateComment(@PathVariable Long id, @RequestBody Comment comment) {
        try {
            comment.setId(id);
            Comment updatedComment = commentService.saveComment(comment);
            return ResponseEntity.ok(updatedComment);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 删除评论
     */
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteComment(@PathVariable Long id) {
        try {
            commentService.deleteComment(id);
            return ResponseEntity.noContent().build();
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }

    /**
     * 获取评论的回复
     */
    @GetMapping("/{commentId}/replies")
    public ResponseEntity<List<Comment>> getCommentReplies(@PathVariable Long commentId) {
        try {
            List<Comment> replies = commentService.getCommentReplies(commentId);
            return ResponseEntity.ok(replies);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }
}
```

## 第五章 系统测试与部署

### 5.1 测试环境配置

**本地开发环境**
- JDK 17
- Maven 3.8+
- MySQL 8.0
- IDE: IntelliJ IDEA 或 Eclipse

**Docker部署环境**
- Docker Engine 20.10+
- Docker Compose 2.0+
- 支持ARM64架构的服务器
- Nginx反向代理

### 5.2 功能测试

**用户管理测试**
- 用户注册、登录、权限验证
- 角色权限控制测试
- 用户信息CRUD操作测试

**公告管理测试**
- 公告创建、编辑、发布流程测试
- 富文本编辑器功能测试
- 公告状态管理测试

**互动功能测试**
- 评论系统功能测试
- 点赞收藏功能测试
- 数据统计准确性测试

### 5.3 性能测试

**并发测试**
- 500用户并发访问测试
- 数据库连接池性能测试
- 页面响应时间测试

**压力测试**
- 大数据量查询性能测试
- 文件上传下载性能测试
- 系统稳定性测试

### 5.4 部署指南

**Docker容器化部署**
```bash
# 1. 克隆项目
git clone <repository-url>
cd hello

# 2. 构建和启动服务
docker-compose up -d

# 3. 检查服务状态
docker-compose ps

# 4. 查看日志
docker-compose logs -f app
```

**生产环境配置**
- SSL证书配置
- 数据库备份策略
- 日志管理和监控
- 安全加固措施

## 第六章 系统维护与扩展

### 6.1 日常维护

**数据库维护**
- 定期备份数据库
- 清理过期数据
- 优化查询性能
- 监控数据库状态

**系统监控**
- 应用性能监控
- 错误日志分析
- 用户行为统计
- 系统资源监控

### 6.2 功能扩展

**可扩展功能**
- 文件附件上传
- 邮件通知系统
- 移动端适配
- 多语言支持
- 数据导出功能

**技术升级**
- Spring Boot版本升级
- 数据库版本升级
- 前端框架升级
- 安全补丁更新

## 总结

本校园公告系统采用现代化的技术栈，实现了完整的公告发布和管理功能。系统具有良好的可扩展性和维护性，能够满足高校日常公告管理的需求。通过Docker容器化部署，系统具备了良好的可移植性和部署便利性，支持ARM64架构服务器部署，为系统的推广和应用提供了有力保障。
