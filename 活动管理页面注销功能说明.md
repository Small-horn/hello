# 活动管理页面注销功能说明

## 功能概述
活动管理页面现在已经集成了与其他页面一致的注销登录功能，用户可以安全地退出系统。

## 实现方式

### 1. 认证守卫集成
- **统一认证**：使用`auth-guard.js`提供统一的认证和权限管理
- **自动注销按钮**：系统自动在侧边栏底部添加注销按钮
- **权限控制**：根据用户角色显示/隐藏相应的导航项

### 2. 脚本引入顺序
```html
<script src="js/auth.js"></script>          <!-- 认证工具类 -->
<script src="js/auth-guard.js"></script>    <!-- 认证守卫 -->
<script src="js/activity-management.js"></script> <!-- 页面功能 -->
```

### 3. 权限配置
在`auth-guard.js`中配置了活动管理页面的权限：
```javascript
'activity-management.html': { 
    requireAuth: true, 
    roles: ['ADMIN', 'TEACHER'] 
}
```

## 注销功能特性

### 1. 注销按钮位置
- **位置**：侧边栏底部，在用户信息下方
- **样式**：红色背景，带有注销图标
- **显示**：仅在用户登录后显示

### 2. 注销流程
1. **确认对话框**：点击注销按钮时显示确认对话框
2. **API调用**：调用后端`/api/auth/logout`接口
3. **数据清理**：清除本地存储的用户数据
4. **页面跳转**：自动跳转到登录页面（index.html）

### 3. 安全特性
- **双重确认**：防止误操作
- **数据清理**：彻底清除本地用户数据
- **会话失效**：后端会话同步失效
- **自动跳转**：确保用户安全退出

## 用户体验

### 1. 视觉反馈
- **加载状态**：注销过程中显示"注销中..."状态
- **成功提示**：注销成功后显示提示消息
- **按钮禁用**：防止重复点击

### 2. 错误处理
- **网络错误**：即使API调用失败也会清除本地数据
- **超时处理**：设置合理的超时时间
- **兜底机制**：确保用户能够成功退出

## 权限管理

### 1. 页面访问权限
- **管理员**：完全访问权限
- **教师**：完全访问权限
- **学生/游客**：无法访问，自动跳转

### 2. 功能权限
- **活动发布**：仅管理员和教师可以发布活动
- **数据查看**：非管理员只能查看自己发布的活动
- **操作权限**：根据用户角色动态显示操作按钮

## 技术实现

### 1. 事件监听
```javascript
// 监听页面初始化完成事件
$(document).on('pageInitialized', function(event, user) {
    currentUser = user;
    if (user) {
        init(user);
    } else {
        // 跳转到登录页面
        window.location.href = 'index.html';
    }
});
```

### 2. 权限检查
```javascript
// 检查发布权限
if (user.role !== 'ADMIN' && user.role !== 'TEACHER') {
    showMessage('只有管理员和教师可以发布活动', 'warning');
    $('#add-activity-btn').hide();
}
```

### 3. 注销处理
- **AuthUtils.logout()**：统一的注销方法
- **确认对话框**：防止误操作
- **状态管理**：处理注销过程中的各种状态

## 与其他页面的一致性

### 1. 统一的注销体验
- **相同的注销按钮样式**
- **一致的确认流程**
- **统一的错误处理**

### 2. 统一的权限管理
- **相同的权限检查逻辑**
- **一致的导航显示规则**
- **统一的访问控制**

### 3. 统一的用户体验
- **相同的加载状态**
- **一致的消息提示**
- **统一的页面跳转**

## 测试说明

### 1. 功能测试
1. **登录测试**：使用管理员或教师账号登录
2. **访问测试**：访问活动管理页面
3. **注销测试**：点击注销按钮，确认注销流程
4. **权限测试**：使用不同角色账号测试访问权限

### 2. 边界测试
1. **网络异常**：断网情况下的注销处理
2. **重复点击**：快速多次点击注销按钮
3. **会话过期**：会话过期后的处理

### 3. 兼容性测试
1. **浏览器兼容**：不同浏览器下的注销功能
2. **移动端**：移动设备上的注销体验
3. **响应式**：不同屏幕尺寸下的显示效果

## 注意事项

### 1. 安全考虑
- **数据清理**：确保本地数据完全清除
- **会话管理**：后端会话同步失效
- **跳转安全**：防止恶意跳转

### 2. 用户体验
- **操作确认**：重要操作需要用户确认
- **状态反馈**：及时反馈操作状态
- **错误提示**：友好的错误提示信息

### 3. 维护性
- **代码复用**：使用统一的认证组件
- **配置集中**：权限配置集中管理
- **日志记录**：记录关键操作日志

## 总结

活动管理页面的注销功能已经完全集成到系统的统一认证体系中，提供了：

1. **安全可靠**的注销流程
2. **一致的用户体验**
3. **完善的权限控制**
4. **友好的错误处理**

用户可以安全、便捷地在活动管理页面进行注销操作，享受与其他页面一致的体验。
