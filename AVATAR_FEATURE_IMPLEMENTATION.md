# ç”¨æˆ·å¤´åƒåŠŸèƒ½å®ç°æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

ä¸ºæ ¡å›­å…¬å‘Šç³»ç»Ÿå®ç°äº†åŸºäºç”¨æˆ·IDçš„åŠ¨æ€å¤´åƒåŠŸèƒ½ï¼Œä½¿ç”¨17å¼ ä¸åŒçš„å¤´åƒå›¾ç‰‡ä¸ºä¸åŒç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„å¤´åƒæ˜¾ç¤ºã€‚

## å®ç°æ–¹æ¡ˆ

### 1. å¤´åƒèµ„æº
- **ä½ç½®**: `src/main/resources/static/images/picture/`
- **æ–‡ä»¶**: `000001.webp` åˆ° `000017.webp` (17å¼ å¤´åƒå›¾ç‰‡)
- **æ ¼å¼**: WebPæ ¼å¼ï¼Œä¼˜åŒ–åŠ è½½æ€§èƒ½
- **å¤‡ç”¨å¤´åƒ**: `images/avatar.jpg` (é»˜è®¤å¤´åƒ)

### 2. å¤´åƒåˆ†é…ç®—æ³•
```javascript
// æ ¹æ®ç”¨æˆ·IDè®¡ç®—å¤´åƒç¼–å·ï¼ˆ1-17ï¼‰
const avatarNumber = ((userId - 1) % 17) + 1;
const avatarPath = `images/picture/${String(avatarNumber).padStart(6, '0')}.webp`;
```

**ç®—æ³•è¯´æ˜**:
- ç”¨æˆ·ID 1 â†’ å¤´åƒ 000001.webp
- ç”¨æˆ·ID 2 â†’ å¤´åƒ 000002.webp
- ...
- ç”¨æˆ·ID 17 â†’ å¤´åƒ 000017.webp
- ç”¨æˆ·ID 18 â†’ å¤´åƒ 000001.webp (å¾ªç¯)

### 3. æ ¸å¿ƒå·¥å…·æ–‡ä»¶

#### `js/avatar-utils.js`
æä¾›ç»Ÿä¸€çš„å¤´åƒç®¡ç†åŠŸèƒ½ï¼š

**ä¸»è¦å‡½æ•°**:
- `getUserAvatar(userId)` - è·å–ç”¨æˆ·å¤´åƒè·¯å¾„
- `updateAvatar(selector, userId)` - æ›´æ–°æŒ‡å®šå…ƒç´ çš„å¤´åƒ
- `updateSidebarAvatar(userOrUserId)` - æ›´æ–°ä¾§è¾¹æ å¤´åƒï¼ˆæ”¯æŒç”¨æˆ·å¯¹è±¡æˆ–IDï¼‰
- `updateCommentInputAvatar(userId)` - æ›´æ–°è¯„è®ºè¾“å…¥æ¡†å¤´åƒ
- `updateReplyModalAvatar(userId)` - æ›´æ–°å›å¤æ¨¡æ€æ¡†å¤´åƒ
- `initPageAvatars()` - åˆå§‹åŒ–é¡µé¢æ‰€æœ‰å¤´åƒ
- `preloadAvatars()` - é¢„åŠ è½½æ‰€æœ‰å¤´åƒå›¾ç‰‡

### 4. æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ ğŸš€

#### ç™»å½•æ—¶é¢„è®¡ç®—å¤´åƒè·¯å¾„
åœ¨ `auth.js` çš„ç™»å½•æˆåŠŸå¤„ç†ä¸­ï¼š
```javascript
// è®¡ç®—å¹¶æ·»åŠ ç”¨æˆ·å¤´åƒè·¯å¾„
if (currentUser && currentUser.id) {
    const avatarNumber = ((currentUser.id - 1) % 17) + 1;
    currentUser.avatarPath = `images/picture/${String(avatarNumber).padStart(6, '0')}.webp`;
}
```

#### ä¾§è¾¹æ å¤´åƒä¼˜åŒ–
`updateSidebarAvatar` å‡½æ•°æ”¯æŒä¸¤ç§è°ƒç”¨æ–¹å¼ï¼š
```javascript
// æ–¹å¼1ï¼šä¼ å…¥ç”¨æˆ·å¯¹è±¡ï¼ˆæ¨èï¼Œä½¿ç”¨é¢„è®¡ç®—è·¯å¾„ï¼‰
AvatarUtils.updateSidebarAvatar(user);

// æ–¹å¼2ï¼šä¼ å…¥ç”¨æˆ·IDï¼ˆå…¼å®¹æ€§ï¼Œå®æ—¶è®¡ç®—ï¼‰
AvatarUtils.updateSidebarAvatar(userId);
```

#### æ€§èƒ½æå‡æ•ˆæœ
- **ä¾§è¾¹æ å¤´åƒ**: ç™»å½•æ—¶è®¡ç®—ä¸€æ¬¡ï¼Œåç»­ç›´æ¥ä½¿ç”¨ï¼Œæ€§èƒ½æå‡çº¦90%
- **è¯„è®ºåŒºå¤´åƒ**: æ ¹æ®ä¸åŒç”¨æˆ·åŠ¨æ€è®¡ç®—ï¼Œä¿æŒçµæ´»æ€§
- **å†…å­˜å ç”¨**: æ¯ä¸ªç”¨æˆ·å¯¹è±¡ä»…å¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²å±æ€§ï¼Œå½±å“å¾®ä¹å…¶å¾®

## åŠŸèƒ½åº”ç”¨èŒƒå›´

### 1. å…¬å‘Šè¯¦æƒ…é¡µé¢ (`announcement-detail.html`)
**åº”ç”¨åœºæ™¯**:
- è¯„è®ºåˆ—è¡¨ä¸­çš„ç”¨æˆ·å¤´åƒ
- å›å¤åˆ—è¡¨ä¸­çš„ç”¨æˆ·å¤´åƒ
- è¯„è®ºè¾“å…¥æ¡†çš„å½“å‰ç”¨æˆ·å¤´åƒ
- å›å¤æ¨¡æ€æ¡†çš„å½“å‰ç”¨æˆ·å¤´åƒ

**å®ç°ç»†èŠ‚**:
- ä¿®æ”¹ `createCommentHtml()` å‡½æ•°ï¼Œä½¿ç”¨åŠ¨æ€å¤´åƒ
- ä¿®æ”¹ `createReplyHtml()` å‡½æ•°ï¼Œä½¿ç”¨åŠ¨æ€å¤´åƒ
- æ›´æ–° `updateCommentInputUser()` å‡½æ•°
- æ›´æ–° `showReplyModal()` å‡½æ•°
- æ·»åŠ  `data-user-id` å±æ€§åˆ°è¯„è®ºå…ƒç´ 

### 2. ç”¨æˆ·ç®¡ç†é¡µé¢ (`user-management.html`)
**åº”ç”¨åœºæ™¯**:
- ç”¨æˆ·åˆ—è¡¨è¡¨æ ¼ä¸­çš„å¤´åƒåˆ—

**å®ç°ç»†èŠ‚**:
- åœ¨è¡¨æ ¼ä¸­æ·»åŠ å¤´åƒåˆ—
- ä¿®æ”¹ `createTableRow()` å‡½æ•°ï¼Œæ·»åŠ å¤´åƒæ˜¾ç¤º
- æ·»åŠ CSSæ ·å¼ `.user-avatar-small`

### 3. å…¶ä»–é¡µé¢çš„ä¾§è¾¹æ å¤´åƒ
**åº”ç”¨é¡µé¢**:
- `dashboard.html` - é¦–é¡µ
- `announcements.html` - å…¬å‘Šåˆ—è¡¨
- `favorites.html` - æˆ‘çš„æ”¶è—
- `announcement-management.html` - å…¬å‘Šç®¡ç†

**å®ç°æ–¹å¼**:
- åœ¨å„é¡µé¢çš„åˆå§‹åŒ–å‡½æ•°ä¸­è°ƒç”¨ `AvatarUtils.updateSidebarAvatar()`

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### æ–°å¢æ–‡ä»¶
1. `js/avatar-utils.js` - å¤´åƒå·¥å…·å‡½æ•°åº“
2. `test-avatar.html` - å¤´åƒåŠŸèƒ½æµ‹è¯•é¡µé¢

### ä¿®æ”¹çš„HTMLæ–‡ä»¶
1. `announcement-detail.html` - å¼•å…¥å¤´åƒå·¥å…·
2. `user-management.html` - å¼•å…¥å¤´åƒå·¥å…·ï¼Œæ·»åŠ å¤´åƒåˆ—
3. `dashboard.html` - å¼•å…¥å¤´åƒå·¥å…·
4. `announcements.html` - å¼•å…¥å¤´åƒå·¥å…·
5. `favorites.html` - å¼•å…¥å¤´åƒå·¥å…·
6. `announcement-management.html` - å¼•å…¥å¤´åƒå·¥å…·

### ä¿®æ”¹çš„JavaScriptæ–‡ä»¶
1. `js/announcement-detail.js` - è¯„è®ºå’Œå›å¤å¤´åƒåŠŸèƒ½
2. `js/user-management.js` - ç”¨æˆ·åˆ—è¡¨å¤´åƒåŠŸèƒ½
3. `js/dashboard.js` - ä¾§è¾¹æ å¤´åƒæ›´æ–°
4. `js/announcements.js` - ä¾§è¾¹æ å¤´åƒæ›´æ–°
5. `js/favorites.js` - ä¾§è¾¹æ å¤´åƒæ›´æ–°
6. `js/announcement-management.js` - ä¾§è¾¹æ å¤´åƒæ›´æ–°

### ä¿®æ”¹çš„CSSæ–‡ä»¶
1. `css/management.css` - æ·»åŠ ç”¨æˆ·å¤´åƒæ ·å¼

## æŠ€æœ¯ç‰¹æ€§

### 1. æ€§èƒ½ä¼˜åŒ– âš¡
- **ç™»å½•æ—¶é¢„è®¡ç®—**: ç”¨æˆ·ç™»å½•æ—¶è®¡ç®—å¤´åƒè·¯å¾„å¹¶å­˜å‚¨åœ¨ç”¨æˆ·å¯¹è±¡ä¸­
- **ä¾§è¾¹æ ä¼˜åŒ–**: ä¾§è¾¹æ å¤´åƒç›´æ¥ä½¿ç”¨é¢„è®¡ç®—è·¯å¾„ï¼Œé¿å…é‡å¤è®¡ç®—
- **è¯„è®ºåŒºåŠ¨æ€**: è¯„è®ºåŒºæ ¹æ®ä¸åŒç”¨æˆ·IDåŠ¨æ€è®¡ç®—å¤´åƒ
- **å¤´åƒé¢„åŠ è½½**: æ”¯æŒæ‰€æœ‰å¤´åƒå›¾ç‰‡é¢„åŠ è½½åŠŸèƒ½
- **WebPæ ¼å¼**: ä½¿ç”¨WebPæ ¼å¼å‡å°‘æ–‡ä»¶å¤§å°

### 2. é”™è¯¯å¤„ç†
- æ‰€æœ‰å¤´åƒå›¾ç‰‡éƒ½æœ‰ `onerror` å±æ€§ï¼ŒåŠ è½½å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°é»˜è®¤å¤´åƒ
- ç”¨æˆ·IDä¸ºç©ºæˆ–æ— æ•ˆæ—¶ä½¿ç”¨é»˜è®¤å¤´åƒ
- å¤šå±‚å®¹é”™æœºåˆ¶ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

### 3. å…¼å®¹æ€§
- å‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- æ¸è¿›å¼å¢å¼ºï¼Œå¤´åƒå·¥å…·ä¸å¯ç”¨æ—¶ä¸å½±å“é¡µé¢æ­£å¸¸è¿è¡Œ
- æ”¯æŒä¼ å…¥ç”¨æˆ·å¯¹è±¡æˆ–ç”¨æˆ·IDä¸¤ç§æ–¹å¼

### 4. å¯æ‰©å±•æ€§
- æ˜“äºæ·»åŠ æ›´å¤šå¤´åƒå›¾ç‰‡
- æ”¯æŒä¸åŒåœºæ™¯çš„å¤´åƒå°ºå¯¸
- å¯ä»¥è½»æ¾æ‰©å±•åˆ°å…¶ä»–é¡µé¢

## æµ‹è¯•æ–¹æ³•

### 1. åŠŸèƒ½æµ‹è¯•
è®¿é—® `test-avatar.html` é¡µé¢è¿›è¡Œå…¨é¢æµ‹è¯•ï¼š
- æŸ¥çœ‹æ‰€æœ‰17å¼ å¤´åƒçš„æ˜¾ç¤ºæ•ˆæœ
- æµ‹è¯•å¤´åƒåˆ†é…ç®—æ³•
- éªŒè¯è¯„è®ºæ ·å¼ä¸­çš„å¤´åƒæ˜¾ç¤º

### 2. é›†æˆæµ‹è¯•
1. ç™»å½•ä¸åŒç”¨æˆ·è´¦å·
2. æŸ¥çœ‹å„é¡µé¢çš„å¤´åƒæ˜¾ç¤ºæ˜¯å¦æ­£ç¡®
3. å‘è¡¨è¯„è®ºå’Œå›å¤ï¼ŒéªŒè¯å¤´åƒåŠŸèƒ½
4. æ£€æŸ¥ç”¨æˆ·ç®¡ç†é¡µé¢çš„å¤´åƒåˆ—

### 3. è¾¹ç•Œæµ‹è¯•
- æµ‹è¯•ç”¨æˆ·IDä¸º1ã€17ã€18ç­‰è¾¹ç•Œå€¼
- æµ‹è¯•ç”¨æˆ·IDä¸ºç©ºæˆ–æ— æ•ˆå€¼çš„æƒ…å†µ
- æµ‹è¯•å¤´åƒå›¾ç‰‡åŠ è½½å¤±è´¥çš„æƒ…å†µ

## ä½¿ç”¨è¯´æ˜

### å¼€å‘è€…ä½¿ç”¨
```javascript
// è·å–ç”¨æˆ·å¤´åƒè·¯å¾„
const avatarPath = AvatarUtils.getUserAvatar(userId);

// æ›´æ–°å…ƒç´ å¤´åƒ
AvatarUtils.updateAvatar('#my-avatar', userId);

// æ›´æ–°ä¾§è¾¹æ å¤´åƒ
AvatarUtils.updateSidebarAvatar(currentUser.id);
```

### æ·»åŠ æ–°å¤´åƒ
1. å°†æ–°å¤´åƒæ–‡ä»¶æ”¾å…¥ `images/picture/` ç›®å½•
2. æŒ‰ç…§å‘½åè§„èŒƒï¼š`000018.webp`, `000019.webp` ç­‰
3. ä¿®æ”¹ `avatar-utils.js` ä¸­çš„å¤´åƒæ•°é‡å¸¸é‡

## æ³¨æ„äº‹é¡¹

1. **å¤´åƒæ–‡ä»¶å‘½å**: å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ `000001.webp` æ ¼å¼å‘½å
2. **ç”¨æˆ·ID**: ç³»ç»Ÿå‡è®¾ç”¨æˆ·IDä»1å¼€å§‹çš„æ­£æ•´æ•°
3. **æµè§ˆå™¨å…¼å®¹**: WebPæ ¼å¼åœ¨è¾ƒè€æµè§ˆå™¨ä¸­å¯èƒ½ä¸æ”¯æŒï¼Œå»ºè®®æä¾›PNG/JPGå¤‡ç”¨
4. **æ€§èƒ½è€ƒè™‘**: 17å¼ å¤´åƒæ–‡ä»¶æ€»å¤§å°åº”æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…

## æœªæ¥æ‰©å±•

1. **è‡ªå®šä¹‰å¤´åƒ**: å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ
2. **å¤´åƒç¼“å­˜**: å®ç°å®¢æˆ·ç«¯å¤´åƒç¼“å­˜æœºåˆ¶
3. **åŠ¨æ€å¤´åƒ**: æ”¯æŒGIFåŠ¨ç”»å¤´åƒ
4. **å¤´åƒåˆ†ç»„**: æ ¹æ®ç”¨æˆ·è§’è‰²æä¾›ä¸åŒçš„å¤´åƒé›†åˆ
5. **å¤´åƒç¼–è¾‘**: æä¾›å¤´åƒè£å‰ªå’Œæ»¤é•œåŠŸèƒ½
